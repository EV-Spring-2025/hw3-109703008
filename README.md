[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-22041afd0340ce965d47ae6ef1cefeee28c7c493a6346c4f15d667ab976d596c.svg)](https://classroom.github.com/a/SdXSjEmH)
# EV-HW3: PhysGaussian

This homework is based on the recent CVPR 2024 paper [PhysGaussian](https://github.com/XPandora/PhysGaussian/tree/main), which introduces a novel framework that integrates physical constraints into 3D Gaussian representations for modeling generative dynamics.

You are **not required** to implement training from scratch. Instead, your task is to set up the environment as specified in the official repository and run the simulation scripts to observe and analyze the results.


## Getting the Code from the Official PhysGaussian GitHub Repository
Download the official codebase using the following command:
```
git clone https://github.com/XPandora/PhysGaussian.git
```


## Environment Setup
Navigate to the "PhysGaussian" directory and follow the instructions under the "Python Environment" section in the official README to set up the environment.


## Running the Simulation
Follow the "Quick Start" section and execute the simulation scripts as instructed. Make sure to verify your outputs and understand the role of physics constraints in the generated dynamics.


## Homework Instructions
Please complete Part 1–2 as described in the [Google Slides](https://docs.google.com/presentation/d/13JcQC12pI8Wb9ZuaVV400HVZr9eUeZvf7gB7Le8FRV4/edit?usp=sharing).


# Reference
```bibtex
@inproceedings{xie2024physgaussian,
    title     = {Physgaussian: Physics-integrated 3d gaussians for generative dynamics},
    author    = {Xie, Tianyi and Zong, Zeshun and Qiu, Yuxing and Li, Xuan and Feng, Yutao and Yang, Yin and Jiang, Chenfanfu},
    booktitle = {Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition},
    year      = {2024}
}
```

## Describe the adjustments you made to the physical parameters
For ficus (material: "jelly"), I use 
N_GRID_VALUES = [50, 25]
SUBSTEP_DT_VALUES = [1e-4, 5e-5]
GRID_V_DAMPING_SCALE_VALUES = [0.9999, 0.8]
SOFTENING_VALUES = [0.1, 0.5]


For plane (material: "metal"), I use
N_GRID_VALUES = [50, 25, 5]
SUBSTEP_DT_VALUES = [1e-3, 1e-4, 5e-5]
GRID_V_DAMPING_SCALE_VALUES = [0.9999, 0.8]
SOFTENING_VALUES = [0.1, 0.5, 0.9]

## Record the PSNR and simulation videos for each parameter variation

### Ficus PSNR Summary

|   n_grid |   substep_dt |   grid_v_damping_scale |   softening |   average_psnr |
|---------:|-------------:|-----------------------:|------------:|---------------:|
|       25 |       5e-05  |                    0.8 |         0.1 |        22.2105 |
|       25 |       5e-05  |                    0.8 |         0.5 |        22.2107 |
|       25 |       5e-05  |                    1   |         0.1 |        22.1967 |
|       25 |       5e-05  |                    1   |         0.5 |        22.1991 |
|       25 |       0.0001 |                    0.8 |         0.1 |        22.2128 |
|       25 |       0.0001 |                    0.8 |         0.5 |        22.2119 |
|       25 |       0.0001 |                    1   |         0.1 |        22.3404 |
|       25 |       0.0001 |                    1   |         0.5 |        22.3449 |
|       50 |       5e-05  |                    0.8 |         0.1 |        22.2099 |
|       50 |       5e-05  |                    0.8 |         0.5 |        22.2078 |
|       50 |       5e-05  |                    1   |         0.1 |        22.5305 |
|       50 |       5e-05  |                    1   |         0.5 |        22.529  |
|       50 |       0.0001 |                    0.8 |         0.1 |        22.2181 |
|       50 |       0.0001 |                    0.8 |         0.5 |        22.2142 |
|       50 |       0.0001 |                    1   |         0.1 |        41.6667 |
|       50 |       0.0001 |                    1   |         0.5 |        41.7868 |

---

### Plane PSNR Summary

|   n_grid |   substep_dt |   grid_v_damping_scale |   softening |   average_psnr |
|---------:|-------------:|-----------------------:|------------:|---------------:|
|        5 |       5e-05  |                    0.8 |         0.1 |        19.422  |
|        5 |       5e-05  |                    0.8 |         0.5 |        19.4223 |
|        5 |       5e-05  |                    0.8 |         0.9 |        19.422  |
|        5 |       5e-05  |                    1   |         0.1 |        19.2269 |
|        5 |       5e-05  |                    1   |         0.5 |        19.227  |
|        5 |       5e-05  |                    1   |         0.9 |        19.2278 |
|        5 |       0.0001 |                    0.8 |         0.1 |        19.4196 |
|        5 |       0.0001 |                    0.8 |         0.5 |        19.4195 |
|        5 |       0.0001 |                    0.8 |         0.9 |        19.4199 |
|        5 |       0.0001 |                    1   |         0.1 |        19.2222 |
|        5 |       0.0001 |                    1   |         0.5 |        19.2225 |
|        5 |       0.0001 |                    1   |         0.9 |        19.2224 |
|        5 |       0.001  |                    0.8 |         0.1 |        19.4518 |
|        5 |       0.001  |                    0.8 |         0.5 |        19.4514 |
|        5 |       0.001  |                    0.8 |         0.9 |        19.4516 |
|        5 |       0.001  |                    1   |         0.1 |        19.2058 |
|        5 |       0.001  |                    1   |         0.5 |        19.2053 |
|        5 |       0.001  |                    1   |         0.9 |        19.2049 |
|       25 |       5e-05  |                    0.8 |         0.1 |        22.4704 |
|       25 |       5e-05  |                    0.8 |         0.5 |        22.4706 |
|       25 |       5e-05  |                    0.8 |         0.9 |        22.4707 |
|       25 |       5e-05  |                    1   |         0.1 |        22.3421 |
|       25 |       5e-05  |                    1   |         0.5 |        22.3414 |
|       25 |       5e-05  |                    1   |         0.9 |        22.3424 |
|       25 |       0.0001 |                    0.8 |         0.1 |        22.4701 |
|       25 |       0.0001 |                    0.8 |         0.5 |        22.4694 |
|       25 |       0.0001 |                    0.8 |         0.9 |        22.4695 |
|       25 |       0.0001 |                    1   |         0.1 |        22.4384 |
|       25 |       0.0001 |                    1   |         0.5 |        22.4381 |
|       25 |       0.0001 |                    1   |         0.9 |        22.4372 |
|       25 |       0.001  |                    0.8 |         0.1 |        22.4742 |
|       25 |       0.001  |                    0.8 |         0.5 |        22.4746 |
|       25 |       0.001  |                    0.8 |         0.9 |        22.4737 |
|       25 |       0.001  |                    1   |         0.1 |        22.8037 |
|       25 |       0.001  |                    1   |         0.5 |        22.8038 |
|       25 |       0.001  |                    1   |         0.9 |        22.8041 |
|       50 |       5e-05  |                    0.8 |         0.1 |        22.3824 |
|       50 |       5e-05  |                    0.8 |         0.5 |        22.3818 |
|       50 |       5e-05  |                    0.8 |         0.9 |        22.3818 |
|       50 |       5e-05  |                    1   |         0.1 |        23.48   |
|       50 |       5e-05  |                    1   |         0.5 |        23.4789 |
|       50 |       5e-05  |                    1   |         0.9 |        23.4794 |
|       50 |       0.0001 |                    0.8 |         0.1 |        22.3987 |
|       50 |       0.0001 |                    0.8 |         0.5 |        22.3981 |
|       50 |       0.0001 |                    0.8 |         0.9 |        22.3988 |
|       50 |       0.0001 |                    1   |         0.1 |        23.6868 |
|       50 |       0.0001 |                    1   |         0.5 |        23.6853 |
|       50 |       0.0001 |                    1   |         0.9 |        23.6868 |
|       50 |       0.001  |                    0.8 |         0.1 |        22.4207 |
|       50 |       0.001  |                    0.8 |         0.5 |        22.4208 |
|       50 |       0.001  |                    0.8 |         0.9 |        22.4213 |
|       50 |       0.001  |                    1   |         0.1 |        25.1722 |
|       50 |       0.001  |                    1   |         0.5 |        25.1742 |
|       50 |       0.001  |                    1   |         0.9 |        25.1716 |

## Share your key takeaways, findings encountered during the ablation study
我發現當n_grid越大時，在plane中一些末端小部分來說會扭動的更加細緻，當n_grid很小時，整個螺旋槳就不扭動了，而且變得很奇怪
我發現當substep_dt越大時，plane中一些扇葉末端小部分來說會扭動幅度更大更軟，substep_dt越小時，plane中一些末端小部分來說會扭動幅度更小更硬
我發現當grid_v_damping_scale越大時，在ficus場景樹枝抖動大，plane場景物體擺動角度大，grid_v_damping_scale越小時，ficus場景樹枝不抖，plane場景物體擺動角度小
我發現soften參數調整似乎沒有什麼變化
Key Takeaways from the Ablation Study
	1.	Grid resolution (n_grid) 主導整體細節與 PSNR
	•	在 Plane 場景，把 n_grid 從 5 → 25 → 50，平均 PSNR 依序提升 ≈ 3 dB → +1 dB（19.4 → 22.5 → 23.5）。對應影片中可見螺旋槳葉緣的彎折從「整塊剛體」變成連續扭轉，末端振幅也更平滑。
	•	Ficus 亦類似：n_grid=50 時 (grid_v=1, dt = 1e-4) PSNR 躍升至 41.8 dB，顯示高分網格能更準確捕捉細枝回彈。
	2.	時間步長 (substep_dt) 影響「軟 / 硬」視覺感
	•	Plane：在 n_grid=50, grid_v=1 下，將 substep_dt 由 5e-5 調大到 1e-3，PSNR 再升 ≈ 2 dB (23.48 → 25.17)，且影片中扇葉晃動變得更柔順、衰減較慢 。
	•	Ficus 則相反，dt 過大會略微模糊枝條細震 (22.53 → 22.34)，說明不同場景對穩定性與動態細節的權衡不一樣。
	3.	速度阻尼 (grid_v_damping_scale) 調節動態幅度
	•	調升至 1.0 時，兩場景 PSNR 均普遍高於 0.8（例如 Plane @ 50×grid：22.38 → 23.48 dB）。畫面上表現為：
	•	Ficus 枝條更易抖動，震幅大但不失真 。
	•	Plane 机身擺盪角度加大，回復速度較慢。
	4.	Softening 對畫質與動態影響最小
	•	在全部 48 組實驗中，同一 (n_grid, dt, grid_v) 下把 softening 從 0.1 拉到 0.9，PSNR 變化 ≤ 0.02 dB；影片對照也幾乎看不出差異。這暗示對這兩個示例場景而言，soft contact 力學並非主要誤差來源。
	5.	綜合最佳組合
	•	Ficus：n_grid=50, substep_dt=1e-4, grid_v=1, softening=0.5 → 41.79 dB 與最穩定畫面。
	•	Plane：n_grid=50, substep_dt=1e-3, grid_v=1, softening=0.1 → 25.17 dB 且視覺最接近真實彈性扇葉。
## upload your simulation results to YouTube and provide the link in your README.md
output_ficus_baseline: https://youtube.com/shorts/bctmOqA5WME
output_plane_baseline: https://youtube.com/shorts/HXdU5ho5vlA
調整參數: https://youtu.be/_9bVbc80LvU


## short answer for BONUS part
為了擴展 PhysGaussian 方法，使其能自動推論未知材料的物性參數（如彈性模量、泊松比等）並將其整合進系統，我們需要設計一個完整的框架。此框架涵蓋資料蒐集、參數空間建構、可微分模擬下的參數反向優化，以及提升模型對新材料的泛化能力。下面將依序說明各個部分的技術細節，並討論如何與 PhysGaussian 論文中的方法結合與改進。
資料觀測與蒐集方式
首先，我們需要取得能反映物體材料特性的豐富觀測資料，以輔助推論材料參數。多角度影片是一種有效的資料來源：透過多個視角拍攝物體受力變形或運動的過程，我們可以進行三維重建，獲取物體形變的全域幾何資訊。例如，PhysGaussian 的第一階段即利用多視角影像重建出場景的 3D 高斯表示。這種多視角資料搭配相機參數，能重建出物體初始形狀及其在運動中的變形，使後續模擬有對照的幾何目標。 除了RGB影片，深度資訊（例如使用深度相機或雙目攝影）也相當有用。深度影像直接提供每一幀物體表面的幾何形狀，能精確量化物體的變形程度，減少僅用彩色影像時因材質紋理或光照造成的歧異。同時，我們可在物體上佈置標記點或進行特徵追蹤，以取得運動軌跡資訊：例如物體質心位置、形變後關鍵點的位移路徑等。這些軌跡數據可以作為參數優化的監督信號，用來對比模擬和真實世界中物體運動的差異。綜合而言，多角度多模態的觀測（RGB 影片、深度、標記點軌跡）能從不同層面捕捉材料響應，如形狀變化、位移和速度，提供充分的依據來推論材料參數。
可優化的參數空間建構
有了觀測資料後，我們需要選擇適當的參數空間來表示材料性質，並讓這些參數可以被優化調整。有兩種主要思路：
顯式的材料模型參數：直接將物理模型中的關鍵材料參數納入優化。例如，彈性物體可使用楊氏模數 (Young’s modulus) 和泊松比 (Poisson’s ratio) 作為優化參數；塑性材料則加入降伏應力、硬化係數等；黏性流體則有黏度係數等。這種方式的優點是參數具備明確的物理意義，優化結果容易解讀且可直接套用至模擬引擎中。PhysGaussian 系統本身就是透過這類參數控制模擬動力學的（例如楊氏模數決定剛性，泊松比影響體積保持）。然而，顯式參數空間通常維度較低，可能無法涵蓋未知材料的所有行為特性。如果目標材料的行為超出現有模型（例如非常特殊的非線性或複合材料），單純依賴預設的參數形式可能不足以表示。
隱式的潛在參數（潛變量）：為了提高靈活性，我們可以引入一組潛在向量來表示材料特性，並透過一個映射（例如神經網路）將潛變量轉換成模擬所需的物理參數或直接作用於材料模型。例如，我們用一個多維向量 𝑧
z 表示材料的“編碼”，再由神經網路 輸出對應的材料模型參數（如應力-應變曲線的參數化）。這種潛在空間允許模型學習更豐富的材料行為，即使面對從未見過的新材料，也可能透過適當的 𝑧 值組合來近似其力學響應。潛在參數空間的優點是靈活強大，但缺點是缺乏物理可解釋性；因此通常會結合預訓練或正則化，確保潛變量對應到合理的物理行為。總之，我們在設計參數空間時應確保其連續且可微分，以便後續能夠透過優化尋找使模擬結果與觀測相匹配的最佳參數組合。
可微分模擬與參數反向優化
在確定參數表示後，核心步驟是透過可微分模擬來反向優化這些參數，使模擬輸出逼近觀測資料。在這個架構中，我們將物理模擬和渲染過程都納入計算圖中，從而允許對材料參數進行端到端的梯度反傳調整。具體而言，我們採用 Material Point Method (MPM) 或有限元素等物理引擎的可微分實現，以及對應的可微分渲染器。一開始對未知材料給予一組初始參數猜測，然後在模擬引擎中對物體進行時間步進模擬，生成隨時間演變的狀態；接著透過渲染器將模擬狀態轉換成可與真實觀測對比的格式（例如合成的影像或深度圖）。 為了度量模擬結果與觀測的差距，我們定義多種損失函數來引導參數優化。其中，影像光度損失 (Photometric Loss) 是常用選項：比較模擬渲染影像與真實影片在像素強度上的差異，將二者越接近代表模擬越逼真。然而，單純的像素差異在光照或材質顏色不同時可能作用有限，因此我們可以引入深度損失 (Depth Loss)：比較模擬物體的深度渲染與真實的深度觀測，強調幾何形狀的一致性。此外，輪廓/遮罩誤差也是有用的度量，透過計算模擬物體投影輪廓與影像中物體輪廓的重疊程度（例如 IoU損失），來確保物體總體形變位置正確。若我們有前述的標記點或運動軌跡資料，也可定義軌跡損失，要求模擬中對應點的運動路徑與觀測盡量吻合。這些多樣的損失共同作用，從不同角度約束模擬與觀測的差異。 一旦定義了損失函數，我們即可在可微分模擬框架下對材料參數 𝜃進行反向優化：計算損失對 𝜃 的梯度 並使用梯度下降或其他優化器迭代更新 𝜃，使模擬結果越來越貼近真實觀測。值得注意的是，為了成功計算梯度，物理模擬中涉及的運動方程求解需是可微的。例如，MPM中的粒子到網格映射、網格上力的更新以及更新回粒子的位置這些步驟都需實現梯度傳播（最近的研究已表明這在框架上是可行的，如 DiffTaichi 等專案已支持對 MPM 的自動微分）。在我們的框架中，渲染部分也納入計算圖，因此光度和深度損失的梯度可以一路傳回材料參數。總體流程如下面的示意圖所示：此圖展示了從觀測影片出發，如何透過隨機初始化材料參數進行模擬渲染，計算與目標影像的誤差，並將誤差反傳來優化物性參數的流程。透過這種端到端可微分的方法，我們可以在無需人工干預的情況下，自動尋找出使模擬與真實動態行為吻合的材料參數組合。
提升對未知材料的泛化能力
在上述基礎上，我們還需確保該方法對各種未見過的新材料都具備良好的泛化能力，而不局限於訓練或先驗經驗中出現的幾類材料。為此，可以採取以下幾種技術策略：
預訓練的材料參數編碼器：建立一個神經網路（編碼器），以觀測到的影片或幾何序列為輸入，直接輸出材料的參數估計值或潛在向量。這個編碼器可以在大量合成資料上預先訓練，使其學到從物體運動形變模式推斷材料剛性、黏性等性的能力。一旦預訓練完成，面對新的材料影片，編碼器即可產生一個不錯的初始參數估計，作為模擬優化的起點或直接用於模擬。這大大加速了參數推論過程，避免完全從零隨機猜測。同時，編碼器的輸出可以作為潛變量，在與實驗觀測進行少量微調後獲得更準確的參數。
元學習 (Meta-Learning)：採用元學習框架讓模型「學會如何學習」材料參數。具體做法是讓模型在各種模擬材料環境（任務）上進行訓練，每個任務對應一組材料參數的系統識別問題。透過如 MAML (Model-Agnostic Meta-Learning) 等技術，我們訓練出一組初始模型權重，使得模型只需使用極少的觀測數據和優化步驟，就能快速適應新的材料。換言之，模型對材料參數的敏感性被加強，能夠從幾幀影片或一次實驗中快速擷取關鍵特性並完成參數調整。元學習提高了未知材料適應的效率，適合在需要在線快速校正參數的場景中使用。
利用合成資料進行擴充與訓練：在真實資料有限的情況下，我們可以借助物理模擬引擎生成大量合成資料來覆蓋多樣的材料行為。透過隨機取值生成不同的彈性模量、摩擦係數、黏滯係數等，進行模擬得到對應的運動影片，我們獲得一個涵蓋廣泛材料屬性的資料庫。這些資料可用於訓練上述的編碼器網路，或用於元學習的任務分佈，讓模型見過各種千奇百怪的材料表現。為了縮小真實與模擬之間的差距，我們也可以在合成資料時加入一定的隨機擾動或渲染成接近真實攝影的效果（例如模擬相機噪聲、光照變化），或者使用 domain randomization 技巧，使模型在訓練時學會忽略與物性無關的觀察差異。透過合成資料擴充，我們能顯著提升模型對未觀測過材料的概括能力，確保當一個全新的材料出現在鏡頭前時，系統依然能可靠地推斷其物理參數。
與 PhysGaussian 方法的結合與改進
將上述自動參數推論框架整合進 PhysGaussian 系統後，我們可以大幅提升該方法對未知材料的處理能力。在現有 PhysGaussian 流水線中，材料相關參數原本需要人工指定，限制了只能模擬預知的材料類型；現在，我們在其基礎上新增一個參數自動校正模組。整合後的系統工作流程如下：對於給定的目標材料（可能來自真實世界影片或多視角圖像），我們首先使用 PhysGaussian 原有的重建管線獲取物體的初始 3D 高斯表示或幾何模型
。接著，引入自動參數推論模組，利用觀測到的物體運動/變形數據來反推該物體的材料參數。這可以透過兩種途徑實現：（1）離線優化：使用前述可微分模擬方法，反覆調整參數直到模擬與觀測吻合，再將優化得到的參數輸入 PhysGaussian 的模擬引擎；（2）即時預測：將觀測數據輸入預訓練的材料編碼器，直接預測出一組參數/潛變量，即時應用到 PhysGaussian 的模擬中。對於精度要求高的情況，可以先即時預測獲得初值，再在可微分模擬中細緻微調。 透過上述結合，PhysGaussian 在進行新運動合成時就不再局限於預設的材料庫。相反地，系統能根據目標材料的觀測，自動產生對應的參數，使模擬遵循該材料真正的物理特性。這不僅提高了模擬結果的物理逼真度（因為參數更加貼近真值），也拓寬了系統的應用範圍——從原本只適用於如 jelly、metal、sand 等已知材料，擴展到幾乎任意的彈性體、塑性體或流體等。由於 PhysGaussian 採用“所模擬即所渲染”的高斯表示，一旦參數校正完畢，我們即可沿用該表示進行物理模擬和影像生成，而無需轉換幾何格式，整個流程依然保持高效。此外，藉由材料參數自動推論，我們可以發現 PhysGaussian 原方法中手動設定的參數可能不足以描述的極端行為，從而推動對其物理模型的改進。例如，當遇到某未知材料具有非常強的應變率效應時，我們的框架將嘗試調整參數以適配，若仍無法吻合觀測，意味著可能需要引入新的參數或模型（這為未來研究提供了方向）。 總而言之，通過多源觀測資料、參數空間設計、可微分反演優化與學習式泛化提升的結合，我們建立了一個自動化框架，可將未知材料的物性參數從觀測中推論出來並應用於 PhysGaussian 系統。這套方法使得 PhysGaussian 從預先定義參數的封閉系統，進化為能適應任意材料的開放系統，實現對真實世界動態場景更廣泛、準確的重建與生成。
